---
title: "Project-2"
author: "Jacob Press"
date: '2023-10-09'
output: github_document
---

# Intall Packages  
Below I am installing all the necessary packages.  

```{r packages, message=FALSE, warning=FALSE}
library(jsonlite)
library(tidyverse)
```

# Functions to Quiry API  

Here I made a list of the `teamNames` corresponding to their `teamID`.  

```{r teamList, warning=FALSE, message=FALSE}
outputAPI1 <- fromJSON("https://records.nhl.com/site/api/franchise-season-results")
  list <- outputAPI1$data  
  teamID<- list %>% select(teamId, teamName) %>% arrange(teamId) %>% distinct(teamId, teamName)
  teamID
```

Below is are some function I made to queary the NHL records API. The above data frame serves as a key for the team names and corresponding `teamID`. There is an additional filter the user can add for whether the games are regular season or playoff games.  
* 2 for regular season game  
* 3 for playoff game  

```{r functions, warning=FALSE, message=FALSE}
# team totals for active NHL teams for either regular or playoff games.
allTeamTotals <- function(active = TRUE, game = 2){
  baseURL <- "https://records.nhl.com/site/api/"
  filterURL <- "franchise-team-totals?cayenneExp=activeTeam="
  filterURL2 <- "%20and%20gameTypeId="
  fullURL <- paste0(baseURL, filterURL, active, filterURL2, game)
  output <- fromJSON(fullURL)
  return(output$data)
}
# win loss totals for a given team for either regular or playoff games
teamWLTotals <- function(team = 12, game = 2){
  baseURL <- "https://records.nhl.com/site/api/"
  filterURL1 <- "franchise-team-totals?cayenneExp=teamId="
  fitlerURL2 <- "%20and%20gameTypeId="
  fullURL <- paste0(baseURL, filterURL1, team, fitlerURL2, game)
  outputAPI <- fromJSON(fullURL)
    output <- outputAPI$data %>% select(teamName, contains("wins"), homeLosses, roadLosses, losses, gamesPlayed, gameWinPctg)
    return(output)
}
# win loss totals by season
wlTotalBySeason <- function(){
  outputAPI <- fromJSON("https://records.nhl.com/site/api/franchise-season-results")
    output <- outputAPI$data %>% arrange(teamId)
    return(output)
}  
# win loss totals by season for a given team for regular or playoff games.
teamWLTotalBySeason <- function(team = 12, game = 2){
  baseURL <- "https://records.nhl.com/site/api/"
  filterURL1 <- "franchise-season-results?cayenneExp=teamId="
  fitlerURL2 <- "%20and%20gameTypeId="
  fullURL <- paste0(baseURL, filterURL1, team, fitlerURL2, game)
  outputAPI <- fromJSON(fullURL)
    output <- outputAPI$data %>% select(teamName, seasonId, contains("wins"), homeLosses, roadLosses, losses, gamesPlayed)
    return(output)
}

```

I am interested in finding the best active NHL team.

```{r EDA, warning=FALSE, message=FALSE}
# contingecy table for the number of cups each active NHL team has.
allteamTotals <- allTeamTotals(active = TRUE)
  table(allteamTotals$teamName, allteamTotals$cups)
  
# teams win the 5 highest win percentages
topWinPercent <- allTeamTotals(active = TRUE, game = 2) %>%
  arrange(desc(gameWinPctg)) %>% distinct(teamName, .keep_all = TRUE) %>% select(teamName, teamId, gameWinPctg, cups)
  head(topWinPercent,5)

VegasGoldenKnights <- teamWLTotalBySeason(54,2) %>% mutate(meanWins = mean(wins), winPercent = wins/gamesPlayed)
coloradoAvalanche <- teamWLTotalBySeason(21,2) %>% mutate(meanWins = mean(wins), winPercent = wins/gamesPlayed)
dallasStars <- teamWLTotalBySeason(25,2) %>% mutate(meanWins = mean(wins), winPercent = wins/gamesPlayed)
winnipegJets <- teamWLTotalBySeason(52,2) %>% mutate(meanWins = mean(wins), winPercent = wins/gamesPlayed)
montrealCanadiens <- teamWLTotalBySeason(8,2) %>% mutate(meanWins = mean(wins), winPercent = wins/gamesPlayed)

```


rmarkdown::render(input = "Project-2.Rmd", output_format = "github_document", output_file = "README.md")